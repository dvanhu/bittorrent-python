# app/main.py
"""
Entry point for bittorrent-python.
Keep this file small â€” real logic lives in torrent/, network/, client/, utils/.
"""

import argparse
from pathlib import Path

# local imports (implement these in the modules)
try:
    from torrent.parser import TorrentParser
    from client.engine import TorrentClient
except Exception:
    # If modules don't exist yet, provide graceful fallback for editing on GitHub
    TorrentParser = None
    TorrentClient = None

def parse_args():
    p = argparse.ArgumentParser(description="bittorrent-python client")
    p.add_argument("torrent", help="Path to .torrent file or magnet link")
    p.add_argument("--output", "-o", default="downloads", help="Output directory")
    p.add_argument("--verbose", "-v", action="store_true", help="Verbose logging")
    return p.parse_args()

def main():
    args = parse_args()
    if TorrentParser is None or TorrentClient is None:
        print("Modules not yet implemented. See torrent/, client/, network/ folders.")
        return

    parser = TorrentParser(args.torrent)
    meta = parser.parse()

    out_dir = Path(args.output)
    out_dir.mkdir(parents=True, exist_ok=True)

    client = TorrentClient(meta, output_dir=str(out_dir), verbose=args.verbose)
    client.start()

if __name__ == "__main__":
    main()
